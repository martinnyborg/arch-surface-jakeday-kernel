version: 2
jobs:
  build:
    docker:
      - image: archlinux/base
    steps:
      - checkout
      - run:
          name: Running makepkg
          command: |
            pacman -Sy --needed --noconfirm sudo # Install sudo
            useradd builduser -m # Create the builduser
            passwd -d builduser # Delete the buildusers password
            printf 'builduser ALL=(ALL) ALL\n' | tee -a /etc/sudoers # Allow the builduser passwordless sudo
            sudo su - builduser << EOF
                cd /project
                makepkg -s
            EOF

